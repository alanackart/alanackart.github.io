---
layout:     	post
title:      	C/Cpp Notes and Summary
categories: 	C/CPP
description:   	C/CPPçŸ¥è¯†ç‚¹æ€»ç»“(to be continued)
keywords: 		C/CPP
---

ä»è°­è€å¸ˆçš„ã€Šcè¯­è¨€ç¨‹åºè®¾è®¡ã€‹åˆ°APUE,  ä»C++ Primerèµ°å‘ä½•æ–¹

# static å…¨å±€å˜é‡vsæ™®é€šçš„å…¨å±€å˜é‡

-  static å…¨å±€å˜é‡åªåˆä½¿åŒ–ä¸€æ¬¡ï¼Œé˜²æ­¢åœ¨å…¶ä»–æ–‡ä»¶å•å…ƒä¸­è¢«å¼•ç”¨;    static å±€éƒ¨å˜é‡å’Œæ™®é€šå±€éƒ¨å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š 	static å±€éƒ¨å˜é‡åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡ä¾æ®ä¸Šä¸€æ¬¡ç»“æœå€¼ï¼›    static å‡½æ•°ä¸æ™®é€šå‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š 			static å‡½æ•°åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œæ™®é€šå‡½æ•°åœ¨æ¯ä¸ªè¢«è°ƒç”¨ä¸­ç»´æŒä¸€ä»½æ‹·è´

- ç¨‹åºçš„å±€éƒ¨å˜é‡å­˜åœ¨äºï¼ˆå †æ ˆï¼‰ä¸­ï¼Œå…¨å±€å˜é‡å­˜åœ¨äºï¼ˆé™æ€åŒº ï¼‰ä¸­ï¼ŒåŠ¨æ€ç”³è¯·æ•°æ®å­˜åœ¨äºï¼ˆ å †ï¼‰ä¸­
  union ä¸struct, see https://stackoverflow.com/questions/22844542/sizeofstruct-and-sizeofunion

# sizeof vs strlen

- Sizeof operator is a compile time unary operator(å•ç›®è¿ç®—ç¬¦) which can be used to compute the size of its operand.The result of sizeof is of unsigned integral type which is usually denoted by size_t.
  sizeof can be applied to any data-type, including primitive types such as integer and floating-point types, pointer types, or compound datatypes such as Structure, union etc.
- strlen(): strlen() is a predefined function in C whose definition is contained in the header file â€œstring.hâ€.

# ä¸€ä¸ªé¢‘ç¹ä½¿ç”¨çš„çŸ­å°å‡½æ•°çš„å®ç°

- c ç”¨å®å®šä¹‰
- c++ç”¨ inline 

# å¤šç»´æ•°ç»„çš„å­˜å‚¨

```c
int a[60][250][1000],i,j,k;
for(k=0;k<=1000;k++)
	for(j=0;j<250;j++)
		for(i=0;i<60;i++)
			a[i][j][k]=0;
```


ç­”: æŠŠå¾ªç¯è¯­å¥å†…å¤–æ¢ä¸€ä¸‹

# macro functions

 [å®å‡½æ•°è¯¦è§£](https://stackoverflow.com/questions/14662815/define-squarex-xx)

```c
#include <stdio.h>
#define Square(x) ({ typeof (x) _x = (x); _x * _x; })
#define SQUARE(a)((a)*(a))*

int main() {
    int x = 5;
    printf("%d\n", Square(x++));
    printf("x now is %d!\n", x);
    printf("%d\n", SQUARE(x++));
    return 0;
}
```

# byte å’Œåå…­è¿›åˆ¶

4ä¸ªbit(8 4 2 1)å¯ä»¥ç”¨1ä½16è¿›åˆ¶çš„æ•°æ¥è¡¨ç¤ºï¼Œ æ‰€ä»¥1ä¸ªå­—èŠ‚byteéœ€ç”¨ä¸¤ä½16è¿›åˆ¶æ•°æ¥è¡¨ç¤º

# æ ¼å¼åŒ–è¾“å‡º

%5.2s ï¼š%5.2sä¸­5è¡¨ç¤ºæ˜¾ç¤ºçš„æœ€å°å®½åº¦ï¼Œ2è¡¨ç¤ºç²¾åº¦abideåªæ˜¾ç¤ºå‰ä¸¤ä¸ª

# Linux C system å‡½æ•°

> system() executes a command specified in command by calling /bin/sh -c command, and returns after the command has been completed. During execution of the command, `SIGCHLD` will be blocked, and `SIGINT` and `SIGQUIT` will be ignored. 

system fork shell, shell forkå‡ºcommandç¨‹åºï¼Œ éœ€è¦æ³¨æ„éšå¼ç«¯å£å ç”¨é—®é¢˜

# ç¦ç”¨å†™æ–‡ä»¶ç¼“å­˜

  `setbuf(fp, NULL);` è°ƒè¯•æ—¶å‘ç°æ—¥å¿—æœªè¢«è¾“å‡ºå¯ä»¥ä½¿ç”¨

# å¥‡æ€ªçš„å†™æ³•

`#if 0 stmt1; #else stmt2; #endif`ä¸­stmt1æ˜¯ç›¸å½“äºè¢«æ³¨é‡Šæ‰çš„

- C++ä½¿ç”¨newæ¥å£°æ˜å¯¹è±¡æ—¶éœ€è¦ä½¿ç”¨ç±»æŒ‡é’ˆæ¥æ¥æ”¶ï¼Œè¿™ä¸€ç‚¹å’ŒC#, JAVAä¸åŒï¼Œéœ€è¦æ³¨æ„ä¸‹ï¼Œ å¦å¤–ä¹Ÿéœ€è¦è®°å¾—ç”¨deleteæ¥ä½¿å¾—ææ„å‡½æ•°æ‰§è¡Œã€‚è‹¥ä¸éœ€è¦å¯ç›´æ¥ä½¿ç”¨OBJECT obj(1,2,3)è¿™ç§æ–¹å¼è¿›è¡Œå¯¹è±¡çš„å£°æ˜

# c keyword

- **union(è”åˆ)**: 

  è®°å¾—è‡ªå·±å½“æ—¶é¢è¯•æ—¶ä¸€é“unionç±»å‹å¤§å°çš„é—®é¢˜åšé”™äº†ğŸ˜‚ 

  - what is union:

    A **union** is a special data type available in C that allows to store different data types in the same memory location. You can define a union with many members, but only one member can contain a value at any given time. Unions provide an efficient way of using the same memory location for multiple-purpose. [link](https://www.tutorialspoint.com/cprogramming/c_unions.htm)

    ```c
    union Data {
       int i;
       float f;
       char str[20];
    } data;  
    ```

  -  **è”åˆä¸ç»“æ„çš„åŒºåˆ«**
    â€œè”åˆâ€ä¸â€œç»“æ„â€æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚ä½†ä¸¤è€…æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒã€‚åœ¨ç»“æ„ä¸­å„æˆå‘˜æœ‰å„è‡ªçš„å†…å­˜ç©ºé—´ï¼Œ ä¸€ä¸ªç»“æ„å˜é‡çš„æ€»é•¿åº¦æ˜¯å„æˆå‘˜é•¿åº¦ä¹‹å’Œï¼ˆç©ºç»“æ„é™¤å¤–ï¼ŒåŒæ—¶ä¸è€ƒè™‘è¾¹ç•Œè°ƒæ•´ï¼‰ã€‚è€Œåœ¨â€œè”åˆâ€ä¸­ï¼Œå„æˆå‘˜å…±äº«ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œ ä¸€ä¸ªè”åˆå˜é‡çš„é•¿åº¦ç­‰äºå„æˆå‘˜ä¸­æœ€é•¿çš„é•¿åº¦ã€‚åº”è¯¥è¯´æ˜çš„æ˜¯ï¼Œ è¿™é‡Œæ‰€è°“çš„å…±äº«ä¸æ˜¯æŒ‡æŠŠå¤šä¸ªæˆå‘˜åŒæ—¶è£…å…¥ä¸€ä¸ªè”åˆå˜é‡å†…ï¼Œ è€Œæ˜¯æŒ‡è¯¥è”åˆå˜é‡å¯è¢«èµ‹äºˆä»»ä¸€æˆå‘˜å€¼ï¼Œ**ä½†æ¯æ¬¡åªèƒ½èµ‹ä¸€ç§å€¼ï¼Œ èµ‹å…¥æ–°å€¼åˆ™å†²å»æ—§å€¼ã€‚**

# cpp keyword

- auto & decltype(**to be contiued**): 

  > Type Inference refers to automatic deduction of the data type of an expression in a programming language. Before C++ 11, each data type needs to be explicitly declared at compile time, limiting the values of an expression at runtime but after the new version of C++, many keywords are included which allows a programmer to leave the type deduction to the compiler itself.
  > With type inference capabilities, we can spend less time having to write out things compiler already knows. As all the types are deduced in compiler phase only, the time for compilation increases slightly but it does not affect the run time of the program.

ä¸ç”¨æ˜¾ç¤ºæŒ‡å®šç±»å‹, since C++ 11, è¿™ä¸ªå’ŒC#çš„`var`ä¼¼ä¹ç”¨æ³•å·®ä¸å¤š

# Error & Debug 

- **xxx has initializer but incomplete type** / **class does not name a type**

  type was not defined, less of **header**

- == å’Œ= æé”™äº†ï¼Œ if(a=2) , èµ‹å€¼è¿ç®—çš„å€¼ä¸ºæœ€ç»ˆçš„å·¦å€¼

- errnoåº”è¯¥å»æŸ¥è¾“å‡ºå‰æ‰€è°ƒç”¨çš„å‡½æ•°æ˜¯ä»€ä¹ˆï¼Œ å»çœ‹å‡½æ•°çš„man page

  è°ƒç”¨ä¸€äº›å‡½æ•°åï¼Œæœ€å¥½è¾“å‡ºè¿”å›å€¼å’Œerrno, errnoå€¼çš„å…·ä½“å«ä¹‰å«ä¹‰å¯ä»¥å»æœä¹‹å‰æ‰€è°ƒç”¨å‡½æ•°æˆ–è€…ç›´æ¥google, /usr/include/errno.h, man errno ç­‰æ–¹å¼äº†è§£

  é”™è¯¯è¾“å‡ºï¼Œ strerror(errno)

- è¿›ç¨‹å¡ä½ä¸åŠ¨æˆ–è€…CPUå ç”¨å¤ªé«˜ï¼Œå¯èƒ½æ˜¯è¿›å…¥äº†æ­»å¾ªç¯æˆ–è€…ç­‰å¾…äº‹ä»¶ï¼ˆé˜»å¡ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨`gstack`æˆ–è€…`pstack`æŸ¥çœ‹, linux å¯ä»¥å°è¯•ä½¿ç”¨ `sudo strace -p  pid`

- ä½¿ç”¨`gettimeofday` æŠ¥é”™ï¼Œ å­˜å‚¨å¤§å°æœªçŸ¥å¤šåŠæ˜¯æ²¡æœ‰å¤´æ–‡ä»¶ï¼Œå†æˆ–è€…å°±æ˜¯ç»“æ„ä½“çš„åå­—å†™

- **C++**: Cannot declare member function ...to have static linkage

  æš‚æ—¶åªæ˜¯ç†è§£æ˜¯è¯´å¤´æ–‡ä»¶é‡Œfunctionå®šä¹‰äº†staticåï¼Œfunctionå®ç°æ—¶ä¸éœ€è¦åŠ ï¼Œ éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤

  [è§£é‡Š1](<https://www.badprog.com/c-errors-warnings-cannot-declare-member-function-static-void-myclassmymethod-to-have-static-linkage>) ï¼Œ [è§£é‡Š2](https://blog.csdn.net/guoxiaojie_415/article/details/5364354)ï¼Œ [è§£é‡Š3](https://ask.helplib.com/c++/post_1329112)

- Undefined reference to static variable c++ï¼š

  é™æ€æˆå‘˜å˜é‡æ˜¯å±äºæ•´ä¸ªç±»çš„ï¼Œæ•´ä¸ªç±»(æ‰€æœ‰ç±»çš„å¯¹è±¡ä¸­)åªæœ‰ä¸€ä»½æ‹·è´,ç›¸å½“äºç±»çš„å…¨å±€å˜é‡(è¿™æ˜¯å¯¹äºåŒä¸€è¿›ç¨‹å†…è€Œè¨€, å¤šè¿›ç¨‹é—´æ— æ•ˆ)ã€‚

  é™æ€æˆå‘˜å˜é‡ä¸èƒ½åœ¨ç±»çš„å†…éƒ¨åˆå§‹åŒ–ï¼Œåœ¨ç±»çš„å†…éƒ¨åªæ˜¯å£°æ˜ï¼Œå®šä¹‰å¿…é¡»åœ¨ç±»å¤–,å®šä¹‰æ—¶ä¸èƒ½åŠ ä¸Šstaticå…³é”®å­—ã€‚

  [ç±»çš„æˆå‘˜å˜é‡](https://www.cnblogs.com/LubinLew/p/Cpp-ClassMember.html)
- `strtok`  see man page,  `strtok(line, search)ï¼Œ  token = strtok(NULL, search);` åœ¨`search` è¢«æ‰¾åˆ°çš„æƒ…å†µä¸‹éƒ½ä¸ä¼šæ˜¯åŸæœ¬åˆ†å‰²å‰çš„`line`

# å­è¿›ç¨‹å…±äº«çˆ¶è¿›ç¨‹SOCKETå¼•å‘çš„é—®é¢˜ 

 		åœ¨è°ƒç”¨äº†bindç»‘å®šå¥—æ¥å­—ä¸åœ°å€çš„serverç¨‹åºä¸­è°ƒç”¨systemæ‰§è¡Œcommandæ—¶ï¼Œ ä¼š`fork`å‡º `sh -c`, è¿›è€Œ`fork`å‡º command, è¿™ä¸¤ä¸ªç¨‹åºéƒ½ä¹Ÿå°†**å…±äº«çˆ¶è¿›ç¨‹socketçš„ç»‘å®šå…³ç³»**ï¼Œ è‹¥command å‘½ä»¤æœªèƒ½æ‰§è¡Œç»“æŸï¼Œ è€Œserverç¨‹åºéœ€è¦å†æ¬¡bind

ç«¯å£æ—¶ï¼Œ å°±ä¼šæŠ¥ address already in use çš„é—®é¢˜ï¼Œ [é—®é¢˜åˆ†æ](https://answerwa.github.io/2017/08/30/%E8%AE%B0%E4%B8%80%E6%AC%A1%20system()%20%E5%BC%95%E8%B5%B7%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%8A%A2%E5%8D%A0/)

# strcpyæ—¶æœªå¯¹NULL æŒ‡é’ˆåšåˆ¤æ–­å¯¼è‡´ç¨‹åºcore dump

- äº‹æ•…èƒŒæ™¯ï¼š

  - æŸä¸ªkafka clientåœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶é‡‡å–äº†å¤„ç†å®Œå†commitçš„æœºåˆ¶ï¼Œ ä½†å¤„ç†æ¶ˆæ¯æ—¶æŸä¸€æ®µstrcpy æœªå¯¹NULLæŒ‡é’ˆåšåˆ¤æ–­ï¼Œ å¯¼è‡´æ¶ˆæ¯æŒç»­è¢«æ¶ˆè´¹ï¼Œ ç¨‹åºæŒç»­crash

- strcpy æˆ–å…¶ä»–å‡½æ•°å¤„ç†NULLæŒ‡é’ˆçš„æ–¹æ¡ˆ:

  - é¡¹ç›®ä¸­, `strcpy`, `strnpcy`, `printf`, `fprintf`, `fclose`å¯ä»¥å¯¹NULL pointeråšåˆ¤æ–­ï¼Œ å¯å°è£…ç›¸åº”å‡½æ•°ï¼ˆæ³¨æ„ä»¥ä¸‹`printf`, `strcpy`åœ¨æŸäº›å¹³å°ï¼Œ æŸäº›ç¼–è¯‘å™¨ä¸Šå¯èƒ½ä¼šå¼•å‘core dumpï¼‰

    ```c
    char *str = NULL;
    char str2[20] = {0};
    printf("str is %s\n", str);//linux, gcc ä¸Šæœªcrasshï¼Œ è¾“å‡º(null)
    strcpy(str2, str);//linux, gcc ä¸Šcrassh
    printf("str2 is %s\n", str2);
    fp = fopen("unexist file or no permission", "r");
    fclose(fp);//linux, gcc ä¸Šcrassh
    ```

# Readlist

- undeclared vs undefined: å£°æ˜å’Œå®šä¹‰ï¼Œ [è¦å†é˜…è¯»ï¼Œ ä»ç¼–è¯‘å™¨è§’åº¦ä»”ç»†ç†è§£ä¸‹](https://www.zhihu.com/question/27639400)
- [C++ä¸­æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«](https://www.cnblogs.com/dolphin0520/archive/2011/04/03/2004869.html)
- æ€è€ƒä¸ºä»€ä¹ˆå®é™…ç¡çœ æ—¶é—´æ¯”è®¾æƒ³è¦å°ä¸€äº›çš„åŸå› (ç¨‹åºæœªèƒ½åŠæ—¶ä»ç¡çœ çŠ¶æ€è¿‡åº¦åˆ°å°±ç»ªçŠ¶æ€åæœªèƒ½è·å–åˆ°æ—¶é—´ç‰‡)ï¼Œ [sleep,nanosleepä»¥åŠclock_nanosleepå‡½æ•°](https://www.cnblogs.com/U201013687/p/5540539.html)
- cçš„ç‰ˆæœ¬å†å², ANSI C(1989) ->= C98/C90(1990) -> C99(1999) -> C11(2011) ï¼Œ [ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚](https://blog.csdn.net/ZCShouCSDN/article/details/60588496)
- é‡å…¥ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œå¼‚æ­¥ä¿¡å·å®‰å…¨ï¼Œä¸­æ–­å®‰å…¨å’Œå–æ¶ˆå®‰å…¨ï¼Œ [reentrancy, thread safe, asynchronous signal safe, interrupt safe and cancellation safe](https://sites.google.com/site/embeddedmonologue/home/c-programming/reentrancy-thread-safe-asynchronous-signal-safe-interrupt-safe-and-cancellation-safe)ï¼Œæ³¨æ„å¯é‡å…¥(ä¸€æ¬¡æ‰§è¡Œæœªå®Œæˆå‰å†æ¬¡è°ƒç”¨)å’Œå¹‚ç­‰ï¼ˆå¹‚ç­‰çŸ©é˜µ,idempotent matrix, AA=Aï¼‰ä¸åŒ, ä¸šåŠ¡ä¸Šçš„è§£é‡Šå¯é˜…è¯»[è°ˆè°ˆwebç³»ç»Ÿä¸­çš„å¯é‡å…¥ï¼Œå¹‚ç­‰æ€§ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„é‚£äº›äº‹](https://yuerblog.cc/2016/08/12/talking-about-reentrant-idempotent-distributed-transactions-in-web-systems-1/)

